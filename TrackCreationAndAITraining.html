
				<!DOCTYPE html>
				<html>
					<head>
						<meta charset="UTF-8">
						<meta name="viewport" content="width=device-width, initial-scale=1" />
						<link rel="stylesheet" href="pluginAssets/katex/katex.css"><script type="application/javascript" src="pluginAssets/mermaid/mermaid.min.js"></script><script type="application/javascript" src="pluginAssets/mermaid/mermaid_render.js"></script><link rel="stylesheet" href="pluginAssets/highlight.js/atom-one-light.css">
						<title>TrackCreationAndAITraining</title>
					</head>
					<body>
						<div class="exported-note"><div class="exported-note-title">TrackCreationAndAITraining</div>

<style>
		/* https://necolas.github.io/normalize.css/ */
		html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}
		article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}
		pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}
		b,strong{font-weight:bolder}small{font-size:80%}img{border-style:none}

		body {
			font-size: 15px;
			color: #32373F;
			word-wrap: break-word;
			line-height: 1.6em;
			background-color: #ffffff;
			font-family: 'Avenir', 'Arial', sans-serif;
			padding-bottom: 0px;
			padding-top: 0px;
		}
		kbd {
			border: 1px solid rgb(220, 220, 220);
			box-shadow: inset 0 -1px 0 rgb(220, 220, 220);
			padding: 2px 4px;
			border-radius: 3px;
			background-color: rgb(243, 243, 243);
		}
		::-webkit-scrollbar {
			width: 7px;
			height: 7px;
		}
		::-webkit-scrollbar-corner {
			background: none;
		}
		::-webkit-scrollbar-track {
			border: none;
		}
		::-webkit-scrollbar-thumb {
			background: rgba(100, 100, 100, 0.3); 
			border-radius: 5px;
		}
		::-webkit-scrollbar-track:hover {
			background: rgba(0, 0, 0, 0.1); 
		}
		::-webkit-scrollbar-thumb:hover {
			background: rgba(100, 100, 100, 0.7); 
		}

		

		/* Remove top padding and margin from first child so that top of rendered text is aligned to top of text editor text */

		#rendered-md > h1:first-child,
		#rendered-md > h2:first-child,
		#rendered-md > h3:first-child,
		#rendered-md > h4:first-child,
		#rendered-md > ul:first-child,
		#rendered-md > ol:first-child,
		#rendered-md > table:first-child,
		#rendered-md > blockquote:first-child,
		#rendered-md > img:first-child,
		#rendered-md > p:first-child {
			margin-top: 0;
			padding-top: 0;
		}
		
		p, h1, h2, h3, h4, h5, h6, ul, table {
			margin-top: .6em;
			margin-bottom: 1.35em;

			/*
				Adds support for RTL text in the note body. It automatically detects the direction using the content.
				Issue: https://github.com/laurent22/joplin/issues/3991
			*/
			unicode-bidi: plaintext;
		}

		h1, h2, h3, h4, h5, h6, ul, table {
			margin-bottom: 0.65em;
		}

		h1, h2, h3, h4, h5, h6 {
			line-height: 1.5em;
		}
		h1 {
			font-size: 1.5em;
			font-weight: bold;
			border-bottom: 1px solid #dddddd;
			padding-bottom: .3em;
		}
		h2 {
			font-size: 1.3em;
			font-weight: bold;
			padding-bottom: .1em; */
		}
		h3 {
			font-size: 1.1em;
			font-weight: bold;
		}
		h4, h5, h6 {
			font-size: 1em;
			font-weight: bold;
		}

		.exported-note-title {
			font-size: 2em;
			font-weight: bold;
			margin-bottom: 0.8em;
			line-height: 1.5em;
			padding-bottom: .35em;
			border-bottom: 1px solid #dddddd;
		}

		a {
			color: #155BDA;
		}
		ul, ol {
			padding-left: 0;
			margin-left: 1.7em;
		}
		li {
			margin-bottom: .4em;
		}
		li p {
			margin-top: 0.2em;
			margin-bottom: 0;
		}

		.resource-icon {
			display: inline-block;
			position: relative;
			top: 0.3em;
			text-decoration: none;
			width: 1.2em;
			height: 1.4em;
			margin-right: 0.4em;
			background-color:  #155BDA;
		}
    /* These icons are obtained from the wonderful ForkAwesome project by copying the src svgs 
     * into the css classes below.
     * svgs are obtained from https://github.com/ForkAwesome/Fork-Awesome/tree/master/src/icons/svg
     * instead of the svg width, height property you must use a viewbox here, 0 0 1536 1792 is typically the actual size of the icon
     * each line begins with the pre-amble -webkit-mask: url("data:image/svg+xml;utf8,
     * and of course finishes with ");
     * to precvent artifacts it is also necessary to include -webkit-mask-repeat: no-repeat;
     * on the following line
     * */
		.fa-joplin {
			/* Awesome Font file */
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M373.834 128C168.227 128 0 296.223 0 501.834v788.336C0 1495.778 168.227 1664 373.834 1664h788.336c205.608 0 373.83-168.222 373.83-373.83V501.834C1536 296.224 1367.778 128 1162.17 128zm397.222 205.431h417.424a7.132 7.132 0 0 1 7.132 7.133v132.552c0 4.461-3.619 8.073-8.077 8.073h-57.23c-24.168 0-43.768 19.338-44.284 43.374v2.377h-.017v136.191h-.053l-.466 509.375c-5.02 77.667-39.222 149.056-96.324 201.046-60.28 54.834-141.948 85.017-229.962 85.017-12.45 0-25.208-.61-37.907-1.785-92.157-8.682-181.494-48.601-251.662-112.438-71.99-65.517-117.147-150.03-127.164-238-11.226-98.763 23.42-192.783 95.045-257.937 81.99-74.637 198.185-101.768 316.613-75.704 5.574 1.227 9.55 6.282 9.55 11.997v199.52c-.199 2.625-1.481 6.599-8.183 2.896-.663-.365-1.194-.511-1.653-.531-21.987-10.587-45.159-17.57-68.559-19.916-.38-.04-.757-.124-1.138-.163-.537-.048-1.034-.033-1.556-.075-4.13-.354-8.183-.517-12.203-.58-.87-.011-1.771-.127-2.641-.127-.486 0-.951.05-1.437.057-1.464.011-2.886.115-4.33.163-2.76.102-5.497.211-8.182.448-.273.024-.547.07-.835.097-25.509 2.4-47.864 11.104-65.012 25.47-.954.802-1.974 1.53-2.9 2.36a1.34 1.34 0 0 1-.168.146c-23.96 21.8-34.881 53.872-30.726 90.316 4.62 40.737 26.94 81.156 62.841 113.823 35.908 32.67 80.335 52.977 125.113 57.186 35.118 3.36 66.547-3.919 89.899-20.461a97.255 97.255 0 0 0 9.365-7.501c2.925-2.661 5.569-5.5 8.086-8.416.3-.348.672-.673.975-1.024 8.253-9.864 14.222-21.067 17.996-33.148.639-2.034 1.051-4.148 1.564-6.227.381-1.563.81-3.106 1.112-4.693.555-2.784.923-5.632 1.253-8.49.086-.709.183-1.414.237-2.128.492-4.893.693-9.858.55-14.91h.013V521.623c-2.01-22.626-20.78-40.434-43.928-40.434h-57.23a8.071 8.071 0 0 1-8.077-8.073V340.564a7.132 7.132 0 0 1 7.136-7.133z'/></svg>");
		}
		.fa-file-image {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zm-128-448v320H256v-192l192-192 128 128 384-384zm-832-192c-106 0-192-86-192-192s86-192 192-192 192 86 192 192-86 192-192 192z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-pdf {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zm-514-593c25 20 53 38 84 56 42-5 81-7 117-7 67 0 152 8 177 49 7 10 13 28 2 52-1 1-2 3-3 4v1c-3 18-18 38-71 38-64 0-161-29-245-73-139 15-285 46-392 83-103 176-182 262-242 262-10 0-19-2-28-7l-24-12c-3-1-4-3-6-5-5-5-9-16-6-36 10-46 64-123 188-188 8-5 18-2 23 6 1 1 2 3 2 4 31-51 67-116 107-197 45-90 80-178 104-262-32-109-42-221-24-287 7-25 22-40 42-40h22c15 0 27 5 35 15 12 14 15 36 9 68-1 3-2 6-4 8 1 3 1 5 1 8v30c-1 63-2 123-14 192 35 105 87 190 146 238zm-576 411c30-14 73-57 137-158-75 58-122 124-137 158zm398-920c-10 28-10 76-2 132 3-16 5-31 7-44 2-17 5-31 7-43 1-3 2-5 4-8-1-1-1-3-2-5-1-18-7-29-13-36 0 2-1 3-1 4zm-124 661c88-35 186-63 284-81-10-8-20-15-29-23-49-43-93-103-127-176-19 61-47 126-83 197-15 28-30 56-45 83zm646-16c-5-5-31-24-140-24 49 18 94 28 124 28 9 0 14 0 18-1 0-1-1-2-2-3z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-word {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zM233 768v107h70l164 661h159l128-485c5-15 8-30 10-46 1-8 2-16 2-24h4l3 24c3 14 4 30 9 46l128 485h159l164-661h70V768h-300v107h90l-99 438c-4 16-6 33-7 46l-2 21h-4c0-6-2-14-3-21-3-13-5-30-9-46L825 768H711l-144 545c-4 16-5 33-8 46l-4 21h-4l-2-21c-1-13-3-30-7-46l-99-438h90V768H233z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-powerpoint {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zm-992-234v106h327v-106h-93v-167h137c43 0 82-2 118-15 90-31 146-124 146-233s-54-193-137-228c-38-15-84-19-130-19H416v107h92v555h-92zm353-280H650V882h120c35 0 62 6 83 18 36 21 56 62 56 115 0 56-20 99-62 120-21 10-47 15-78 15z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-excel {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zm-979-234v106h281v-106h-75l103-161c12-19 18-34 21-34h2c1 4 3 7 5 10 4 8 10 14 17 24l107 161h-76v106h291v-106h-68l-192-273 195-282h67V768H828v107h74l-103 159c-12 19-21 34-21 33h-2c-1-4-3-7-5-10-4-7-9-14-17-23L648 875h76V768H434v107h68l189 272-194 283h-68z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-audio {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zM620 850c12 5 20 17 20 30v544c0 13-8 25-20 30-4 1-8 2-12 2-8 0-16-3-23-9l-166-167H288c-18 0-32-14-32-32v-192c0-18 14-32 32-32h131l166-167c10-9 23-12 35-7zm417 689c19 0 37-8 50-24 83-102 129-231 129-363s-46-261-129-363c-22-28-63-32-90-10-28 23-32 63-9 91 65 80 100 178 100 282s-35 202-100 282c-23 28-19 68 9 90 12 10 26 15 40 15zm-211-148c17 0 34-7 47-20 56-60 87-137 87-219s-31-159-87-219c-24-26-65-27-91-3-25 24-27 65-2 91 33 36 52 82 52 131s-19 95-52 131c-25 26-23 67 2 91 13 11 29 17 44 17z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-video {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zM768 768c70 0 128 58 128 128v384c0 70-58 128-128 128H384c-70 0-128-58-128-128V896c0-70 58-128 128-128h384zm492 2c12 5 20 17 20 30v576c0 13-8 25-20 30-4 1-8 2-12 2-8 0-17-3-23-9l-265-266v-90l265-266c6-6 15-9 23-9 4 0 8 1 12 2z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-archive {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M640 384V256H512v128h128zm128 128V384H640v128h128zM640 640V512H512v128h128zm128 128V640H640v128h128zm700-388c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H768v128H640V128H128v1536h1280zM781 943c85 287 107 349 107 349 5 17 8 34 8 52 0 111-108 192-256 192s-256-81-256-192c0-18 3-35 8-52 0 0 21-62 120-396V768h128v128h79c29 0 54 19 62 47zm-141 465c71 0 128-29 128-64s-57-64-128-64-128 29-128 64 57 64 128 64z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-code {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zM480 768c11-14 31-17 45-6l51 38c14 11 17 31 6 45l-182 243 182 243c11 14 8 34-6 45l-51 38c-14 11-34 8-45-6l-226-301c-8-11-8-27 0-38zm802 301c8 11 8 27 0 38l-226 301c-11 14-31 17-45 6l-51-38c-14-11-17-31-6-45l182-243-182-243c-11-14-8-34 6-45l51-38c14-11 34-8 45 6zm-620 461c-18-3-29-20-26-37l138-831c3-18 20-29 37-26l63 10c18 3 29 20 26 37l-138 831c-3 18-20 29-37 26z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-alt, .fa-file-csv {
      /* fork-awesome doesn't have csv so we use the text icon */
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zM384 800c0-18 14-32 32-32h704c18 0 32 14 32 32v64c0 18-14 32-32 32H416c-18 0-32-14-32-32v-64zm736 224c18 0 32 14 32 32v64c0 18-14 32-32 32H416c-18 0-32-14-32-32v-64c0-18 14-32 32-32h704zm0 256c18 0 32 14 32 32v64c0 18-14 32-32 32H416c-18 0-32-14-32-32v-64c0-18 14-32 32-32h704z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		blockquote {
			border-left: 4px solid rgb(220, 220, 220);
			padding-left: 1.2em;
			margin-left: 0;
			opacity: 0.7;
		}

		.jop-tinymce table,
		table {
			text-align: left;
			border-collapse: collapse;
			border: 1px solid rgb(220, 220, 220);
			background-color: #ffffff;
		}

		.jop-tinymce table td, .jop-tinymce table th,
		table td, th {
			text-align: left;
			padding: .5em 1em .5em 1em;
			font-size: 15;
			color: #32373F;
			font-family: 'Avenir', 'Arial', sans-serif;
		}

		.jop-tinymce table td,
		table td {
			border: 1px solid rgb(220, 220, 220);
		}

		.jop-tinymce table th,
		table th {
			border: 1px solid rgb(220, 220, 220);
			border-bottom: 2px solid rgb(220, 220, 220);
			background-color: rgb(247, 247, 247);
		}

		.jop-tinymce table tr:nth-child(even),
		table tr:nth-child(even) {
			background-color: rgb(247, 247, 247);
		}

		.jop-tinymce table tr:hover,
		table tr:hover {
			background-color: #e5e5e5;
		}

		hr {
			border: none;
			border-bottom: 2px solid #dddddd;
		}
		img {
			max-width: 100%;
			height: auto;
		}
		
		.inline-code,
		.mce-content-body code {
			border: 1px solid rgb(220, 220, 220);
			background-color: rgb(243, 243, 243);
			padding-right: .2em;
			padding-left: .2em;
			border-radius: .25em;
			color: rgb(0,0,0);
			font-size: .9em;
		}

		.highlighted-keyword {
			background-color: #F3B717;
			color: black;
		}

		.not-loaded-resource img {
			width: 1.15em;
			height: 1.15em;
			background: white;
			padding: 2px !important;
			border-radius: 2px;
			box-shadow: 0 1px 3px #000000aa;
		}

		a.not-loaded-resource img {
			margin-right: .2em;
		}

		a.not-loaded-resource {
			display: flex;
			flex-direction: row;
			align-items: center;
		}

		.md-checkbox input[type=checkbox]:checked {
			opacity: 0.7;
		}

		.jop-tinymce ul.joplin-checklist .checked,
		.md-checkbox .checkbox-label-checked {
			opacity: 0.5;
		}

		.exported-note {
			padding: 1em;
		}

		.joplin-editable .joplin-source {
			display: none;
		}

		mark {
			background: #F7D26E;
			color: black;
		}

		/* =============================================== */
		/* For TinyMCE */
		/* =============================================== */

		.mce-content-body {
			/* Note: we give a bit more padding at the bottom, to allow scrolling past the end of the document */
			padding: 5px 10px 10em 0;
		}

		/*
		.mce-content-body code {
			background-color: transparent;
		}
		*/

		.mce-content-body [data-mce-selected=inline-boundary] {
			background-color: transparent;
		}

		.mce-content-body .joplin-editable {
			cursor: pointer !important;
		}

		.mce-content-body.mce-content-readonly {
			opacity: 0.5;
		}

		/* We need that to make sure click events have the A has a target */
		.katex a span {
			pointer-events: none;
		}

		.media-player {
			width: 100%;
			margin-top: 10px;
		}

		.media-player.media-pdf {
			min-height: 100vh;
		}

		/* Clear the CODE style if the element is within a joplin-editable block */
		.mce-content-body .joplin-editable code {
			border: none;
			background: none;
			padding: 0;
			color: inherit;
			font-size: inherit;
		}

		/* To make code blocks horizontally scrollable */
		/* https://github.com/laurent22/joplin/issues/5740 */
		pre.hljs {
			overflow-x: auto;
		}

		/* =============================================== */
		/* For TinyMCE */
		/* =============================================== */

		@media print {
			body {
				height: auto !important;
			}

			pre {
				white-space: pre-wrap;
			}

			.code, .inline-code {
				border: 1px solid #CBCBCB;
			}

			#joplin-container-content {
				/* The height of the content is set dynamically by JavaScript (in updateBodyHeight) to go
				   around various issues related to scrolling. However when printing we don't want this
				   fixed size as that would crop the content. So we set it to auto here. "important" is
				   needed to override the style set by JavaScript at the element-level. */
				height: auto !important;
			}
		}
	

				/*
					FOR THE MARKDOWN EDITOR
				*/

				/* Remove the indentation from the checkboxes at the root of the document
				   (otherwise they are too far right), but keep it for their children to allow
				   nested lists. Make sure this value matches the UL margin. */

				li.md-checkbox {
					list-style-type: none;
				}

				li.md-checkbox input[type=checkbox] {
					margin-left: -1.71em;
					margin-right: 0.7em;
				}
				
				ul.joplin-checklist {
					list-style:none;
				}

				/*
					FOR THE RICH TEXT EDITOR
				*/

				ul.joplin-checklist li::before {
					content:"\f14a";
					font-family:"Font Awesome 5 Free";
					background-size: 16px 16px;
					pointer-events: all;
					cursor: pointer;
					width: 1em;
					height: 1em;
					margin-left: -1.3em;
					position: absolute;
					color: #32373F;
				}

				.joplin-checklist li:not(.checked)::before {
					content:"\f0c8";
				}
.mermaid { background-color: white; width: 640px; }</style><div id="rendered-md"><h1 id="track-creation-and-ai-training">Track Creation and AI training</h1>
<p><a id="index" class="jop-noMdConv" href="#"></a><br>
<a data-from-md title='#1.x' href='#1.x'>1. Introduction</a><br>
<a data-from-md title='#2.x' href='#2.x'>2. Google API changes and attempted resolution</a><br>
<a data-from-md title='#3.x' href='#3.x'>3. What are .frc and .trk files</a><br>
<a data-from-md title='#4.x' href='#4.x'>4. Track creation requirements</a><br>
<a data-from-md title='#5.x' href='#5.x'>5. A Trivial Example track: Portugal Circle (a test)</a><br>
<a data-from-md title='#6.x' href='#6.x'>6. Thailand International Circuit</a><br>
<a data-from-md title='#7.x' href='#7.x'>7. Portugal International Circuit</a><br>
<a data-from-md title='#8.x' href='#8.x'>8. Integrating new tracks into the game</a></p>
<p><a id="1.x" class="jop-noMdConv" href="#"></a><br>
Jump to  <a data-from-md title='#index' href='#index'>this index</a></p>
<h1 id="1-introduction">1. Introduction</h1>
<p>Tracks in MotoGP Championship Quest are modelled as bi-cubic patches.</p>
<p>During development of the track these are stored in a file called <code class="inline-code">&lt;track_name&gt;_friction1.ini</code> .  These are finally converted into <code class="inline-code">.frc</code> files, an encrypted format for use in the final product.</p>
<p>Dorna provided 2D pdf and dwg files files along with a gps trace of a lap performed on the track. I originally explored using these but the gps data was rather noisy, had no clear mapping to the 2d data and was not a mapping of both edges of the track.</p>
<p>I eventually decided to write a web tool to extract the track boundaries and elevations from google via the google maps and google earth apis. Initial work on this was derived from some published code at www.daftlogic.com.</p>
<p>I cannot remember which version of the tools I finally used. There are two versions:</p>
<ul>
<li><code class="inline-code">MotoGPTrace.html</code> using <code class="inline-code">tracelatlong.js</code></li>
<li><code class="inline-code">MotoGPTrace_ge.html</code> using <code class="inline-code">tracelatlong_ge.js</code></li>
</ul>
<p>Though the _ge version definitely has more functionality including kml import and Douglas Peuker filtering and spline fitting. However google updated and deprecated APIs after the original series of tracks were created so I had to update and make a new version <strong>MotoGPTrace_v3</strong></p>
<p><a id="2.x" class="jop-noMdConv" href="#"></a><br>
Jump to  <a data-from-md title='#index' href='#index'>this index</a></p>
<h1 id="2-google-api-changes-and-attempted-resolution">2. Google API changes and attempted resolution</h1>
<h3 id="google-earth-version-no-longer-supported-by-google">Google Earth version no longer supported by Google</h3>
<p><strong>Unfortunately</strong> Google no longer support the Google Earth API <a data-from-md title='https://developers.google.com/earth/' href='https://developers.google.com/earth/'>https://developers.google.com/earth/</a><br>
<img src="../../_resources/30c1626c032e46e18659b7c643aff18f.png" alt="1a915015e7a707650032c0a97125379a.png"></p>
<hr>
<h2 id="google-maps-requires-update-to-a-new-api">Google Maps requires update to a new API</h2>
<p>In the debug console (F12) I see:</p>
<blockquote>
<p>util.js:240 Google Maps JavaScript API warning: NoApiKeys <a data-from-md title='https://developers.google.com/maps/documentation/javascript/error-messages#no-api-keys' href='https://developers.google.com/maps/documentation/javascript/error-messages#no-api-keys'>https://developers.google.com/maps/documentation/javascript/error-messages#no-api-keys</a></p>
</blockquote>
<p>which says:<br>
<img src="../../_resources/dbe411fad98e4567afa2382ad7ff9251.png" alt="11d51737bcf4d1f7a95f9838194a5076.png"></p>
<p>following the link <a data-from-md title='https://developers.google.com/maps/documentation/javascript/v2tov3' href='https://developers.google.com/maps/documentation/javascript/v2tov3'>v2 to v3 upgrade guide</a>:</p>
<blockquote>
<p>The Maps JavaScript API v2 is no longer available as of May 26, 2021. As a result, your site's v2 maps will stop working, and will return JavaScript errors. To continue using maps on your site, migrate to the Maps JavaScript API v3. This guide will help you through the process.</p>
</blockquote>
<p><strong>Clearly I will have to rewrite the tool</strong>. First to get v3 working then to port the new features from the _ge version.</p>
<h2 id="first-update-google-maps-version-to-v3">First update Google Maps version to v3</h2>
<p>Copied files, producing:</p>
<ul>
<li><code class="inline-code">MotoGPTrace_v3.html</code> using <code class="inline-code">tracelatlong_v3.js</code><br>
Following the steps:</li>
</ul>
<h2 id="get-a-new-key">Get a new key.</h2>
<blockquote>
<h2 id="your-new-key">Your New Key</h2>
<p>The Maps JavaScript API v3 uses a new key system from v2. you may already be using a v3 key with your application, in which case no change is needed. To verify, check the the URL from which you load the Maps JavaScript API for its key parameter. If the key value starts with '<strong>ABQIAA</strong>', you are using a v2 key. If you have a v2 key, you must upgrade to a v3 key as a part of the migration, which will:</p>
</blockquote>
<blockquote>
<ul>
<li>Allow you to monitor your API usage in the Google Cloud Console.</li>
<li>Allow you to purchase additional quota when required.</li>
<li>Give Google a way to contact you about your application.</li>
</ul>
</blockquote>
<blockquote>
<p>The key is passed when loading the Maps JavaScript API v3. <a data-from-md title='https://developers.google.com/maps/documentation/javascript/get-api-key' href='https://developers.google.com/maps/documentation/javascript/get-api-key'>Learn more about generating API keys.</a></p>
</blockquote>
<p>Indeed I have a v2 key:<br>
<code class="inline-code">C:\MotoGP\WebTools\MotoGPTrace_ge.html (1 hit)</code></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="html" data-joplin-source-open="```html&#10;" data-joplin-source-close="&#10;```">Line 43: 	&lt;script type=&quot;text/javascript&quot; src=&quot;http://www.google.com/jsapi?hl=en&amp;amp;key=ABQIAAAAwbkbZLyhsmTCWXbTcjbgbRSzHs7K5SvaUdm8ua-Xxy_-2dYwMxQMhnagaawTo7L1FE1-amhuQxIlXw&quot;&gt;&lt;/script&gt;</pre><pre class="hljs"><code>Line 43: 	<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://www.google.com/jsapi?hl=en<span class="hljs-symbol">&amp;amp;</span>key=ABQIAAAAwbkbZLyhsmTCWXbTcjbgbRSzHs7K5SvaUdm8ua-Xxy_-2dYwMxQMhnagaawTo7L1FE1-amhuQxIlXw&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div>
<p><code class="inline-code">C:\MotoGP\WebTools\On Wiki\MotoGPTrace_ge.html (1 hit)</code></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="html" data-joplin-source-open="```html&#10;" data-joplin-source-close="&#10;```">Line 43: 	&lt;script type=&quot;text/javascript&quot; src=&quot;http://www.google.com/jsapi?hl=en&amp;amp;key=ABQIAAAAwbkbZLyhsmTCWXbTcjbgbRSzHs7K5SvaUdm8ua-Xxy_-2dYwMxQMhnagaawTo7L1FE1-amhuQxIlXw&quot;&gt;&lt;/script&gt;</pre><pre class="hljs"><code>Line 43: 	<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://www.google.com/jsapi?hl=en<span class="hljs-symbol">&amp;amp;</span>key=ABQIAAAAwbkbZLyhsmTCWXbTcjbgbRSzHs7K5SvaUdm8ua-Xxy_-2dYwMxQMhnagaawTo7L1FE1-amhuQxIlXw&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div>
<blockquote>
<p>key=<strong>ABQIAA</strong>AAwbkbZLyhsmTCWXbTcjbgbRSzHs7K5SvaUdm8ua-Xxy_-2dYwMxQMhnagaawTo7L1FE1-amhuQxIlXw</p>
</blockquote>
<p>Note I used googles key from their example and the elevation service seems to just work then:<br>
<code class="inline-code">C:\MotoGP\WebTools\MotoGPTrace_v3.html (1 hit)</code></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="html" data-joplin-source-open="```html&#10;" data-joplin-source-close="&#10;```">Line 79: 	&lt;script type=&quot;text/javascript&quot; src=&quot;https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&quot;&gt;&lt;/script&gt;</pre><pre class="hljs"><code>Line 79: 	<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div>
<blockquote>
<p>key=<strong>AIza</strong>SyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg</p>
</blockquote>
<p>I also created a new key on <a data-from-md title='https://console.cloud.google.com/google/maps-apis/credentials?_ga=2.194869029.947169342.1628195299-787611625.1628195299&amp;project=motogp-championship-quest' href='https://console.cloud.google.com/google/maps-apis/credentials?_ga=2.194869029.947169342.1628195299-787611625.1628195299&amp;project=motogp-championship-quest'>https://console.cloud.google.com/google/maps-apis/credentials?_ga=2.194869029.947169342.1628195299-787611625.1628195299&amp;project=motogp-championship-quest</a> but must add billing info to use it.</p>
<blockquote>
<p>key = AIzaSyDiwWXaoIXMimPsqRSZZsL9WasZFA7eE4I</p>
</blockquote>
<p><a id="3.x" class="jop-noMdConv" href="#"></a><br>
Jump to  <a data-from-md title='#index' href='#index'>this index</a></p>
<h1 id="3-what-are-frc-and-trk-files">3. What are .frc and .trk files</h1>
<p><strong>.frc</strong> (friction) and <strong>.trk</strong> (track) files define the track surface as bicubic spline patches and waypoints with control details for the AI. They are just encrypted versions of the human readable (.ini style) versions of this data</p>
<p>The C++ library is built for Android and iOS, but for development purposes can be built as a Windows Dynamic Link Library. Testing and development of changes in the library can be easily tested in this way. The dll within Unity is also used in the AI training process ultimately resulting in an .frc and a .trk file for each circuit. These are added to unity in:<br>
<code class="inline-code">Assets\StreamingAssets\conf\env\&lt;track_name&gt;\&lt;track_name&gt;.frc</code><br>
<code class="inline-code">Assets\StreamingAssets\conf\env\&lt;track_name&gt;\&lt;track_name&gt;.trk</code></p>
<p>These are written in an encrypted format in <code class="inline-code">MotoGPActivityRace::Create(const char *raceName).</code>  when ALLOW_LOAD_TRACKS_AS_INI is defined. The <code class="inline-code">&lt;track_name&gt;_ai.ini</code>  and the <code class="inline-code">&lt;track_name&gt;_friction1.ini</code> are read in and processed into the trk and frc files.</p>
<p>The source files for these were all built in:<br>
<code class="inline-code">C:\MotoGP\Dorna Assets\Processed Data\Track CSV and INI files\&lt;track_name&gt;\&lt;track_name&gt;.trk</code><br>
<code class="inline-code">C:\MotoGP\Dorna Assets\Processed Data\Track CSV and INI files\&lt;track_name&gt;\&lt;track_name&gt;.frc</code></p>
<p>The current files in game all match the ones in this build folder except:</p>
<ul>
<li>
<p>for mugello I updated the track in 2017 so the source folder is <code class="inline-code">C:\MotoGP\Dorna Assets\Processed Data\Track CSV and INI files\mugello - 2017\mugello.*</code></p>
</li>
<li>
<p>for catalunya for 2017 the track was changed due to the death of Luis Salom and subsequently restored to the original layout. However until 2021 there was an error in the game. Players reported the bike going under the ground in one of the corners. These files match:</p>
</li>
</ul>
<p>1.. <code class="inline-code">Track CSV and INI files\spain_catalunya\spain_catalunya.frc</code><br>
1.. <code class="inline-code">Assets\StreamingAssets\conf\env\spain_catalunya\spain_catalunya.frc</code></p>
<p>2.. <code class="inline-code">Track CSV and INI files\spain_catalunya\spain_catalunya.trk</code><br>
2.. <code class="inline-code">Assets\StreamingAssets\conf\env\spain_catalunya\spain_catalunya.trk</code></p>
<p>3.. <code class="inline-code">Track CSV and INI files\spain_catalunya - 2017\spain_catalunya.frc</code><br>
3.. <code class="inline-code">Assets\StreamingAssets\conf\env\spain_catalunya\spain_catalunya_2017.frc</code></p>
<p>but<br>
4.. <code class="inline-code">Track CSV and INI files\spain_catalunya - 2017\spain_catalunya.trk</code><br>
did not match:<br>
4.. <code class="inline-code">Assets\StreamingAssets\conf\env\spain_catalunya\spain_catalunya_2017.trk</code></p>
<p>I recreated the track surface and Beep (Alvino) re-did the off track assets and light map to match.</p>
<p>For 2022 I prepared two new tracks Thailand and Portugal.</p>
<p><a id="4.x" class="jop-noMdConv" href="#"></a><br>
Jump to  <a data-from-md title='#index' href='#index'>this index</a></p>
<h1 id="4-track-creation-requirements">4. Track creation requirements</h1>
<p>To create a new track we need:</p>
<ol>
<li>Google maps to be up to date with aerial photography and terrain. For example we<br>
were unable to build the track surface for Kymi Ring in Finland as Google Maps was not up to date.</li>
<li>We need a hot lap video provided by Dorna with on screen telemetry.</li>
</ol>
<p><a id="5.x" class="jop-noMdConv" href="#"></a><br>
Jump to  <a data-from-md title='#index' href='#index'>this index</a></p>
<h1 id="5-a-trivial-example-track-portugal-circle-a-test">5. A Trivial Example track: Portugal Circle (a test)</h1>
<h2 id="step-1-trace-the-track">Step 1: Trace the track</h2>
<p>I ran <a data-from-md title='file:///C:/MotoGP/WebTools/MotoGPTrace_v3.html,' href='file:///C:/MotoGP/WebTools/MotoGPTrace_v3.html,'>file:///C:/MotoGP/WebTools/MotoGPTrace_v3.html,</a> entered 'Portugal International Circuit' in the search box. It found the circuit. I zoomed into a circle and selected the points:<br>
<img src="../../_resources/0aeb95a1b4694ff0913dc78a27a003a3.png" alt="38e8016e1ae20ee1d75e2df3bd5f6737.png"></p>
<p>I had the option set <code class="inline-code">LRLRLRLR</code> and <strong>un</strong>checked <code class="inline-code">Output Lambert?</code></p>
<p>I copied and pasted the data into:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="sh" data-joplin-source-open="```sh&#10;" data-joplin-source-close="&#10;```">C:\MotoGP\Dorna Assets\Processed Data\Track CSV and INI files\portugalcircle\portugalcircle.csv</pre><pre class="hljs"><code>C:\MotoGP\Dorna Assets\Processed Data\Track CSV and INI files\portugalcircle\portugalcircle.csv</code></pre></div>
<p>only save the csv file as &lt;trackname&gt;.csv I saved the example as</p>
<ul>
<li>portugalcirc.csv</li>
</ul>
<h2 id="step-2-smooth-etc-the-track">Step 2: Smooth etc the track</h2>
<p>use <a data-from-md title='file:///C:/MotoGP/WebTools/MotoGPTraceModifier.html' href='file:///C:/MotoGP/WebTools/MotoGPTraceModifier.html'>file:///C:/MotoGP/WebTools/MotoGPTraceModifier.html</a> to process the csv from Step 1.</p>
<p>it allowed me to save:</p>
<ul>
<li>portugalcirc_FromKml.csv</li>
<li>portugalcirc.kml</li>
<li>portugalcirc_FromKml.obj</li>
</ul>
<p>The csv files had the following fields added:<br>
<code class="inline-code">,xPos,yPos,smoothedZ,progress,selected</code></p>
<p>The altitude of the datum in the kml changed slightly but all coorinates remail as latitude and longitude.<br>
The obj file contains 2d coordinates from the Lambert projection.</p>
<h2 id="step-3-remove-unnecessary-points">Step 3: Remove Unnecessary points</h2>
<p>use file <a data-from-md title='file:///C:/MotoGP/WebTools/MotoGPReducePoints.html' href='file:///C:/MotoGP/WebTools/MotoGPReducePoints.html'>file:///C:/MotoGP/WebTools/MotoGPReducePoints.html</a><br>
Select the _FromKml.csv from Step 2<br>
It allows two thresholds, I need to explore these.</p>
<p>It produced:</p>
<ul>
<li>portugalcirc_pointsreduced.csv</li>
</ul>
<p>In this particular case no points were removed, it may be because of the thresholds or because no points should be removed.</p>
<h2 id="step-4-interpolate-path-for-unity-representation">Step 4: Interpolate Path for Unity representation</h2>
<p>use file <a data-from-md title='file:///C:/MotoGP/WebTools/MotoGPInterpolatePath.html' href='file:///C:/MotoGP/WebTools/MotoGPInterpolatePath.html'>file:///C:/MotoGP/WebTools/MotoGPInterpolatePath.html</a></p>
<p>Selected portugalcirc_pointsreduced.csv</p>
<p>it is possible to use the mouse to zoom in and out with wheel and drag with left button.</p>
<p>This is the result:<br>
<img src="../../_resources/52104c466205407daeffc84809805bbc.png" alt="47f8774846fbb38bf39808349cbffaff.png"></p>
<p>It downloads multiple files:</p>
<ul>
<li>portugalcirc_interpolatedPath.obj</li>
<li>portugalcirc_texturedAndCut.obj</li>
<li>portugalcirc_texturedAndCutLOD.obj</li>
<li>portugalcirc_exagerated.obj</li>
</ul>
<h2 id="step-5-build-friction-and-ai-files">Step 5: Build friction and ai files:</h2>
<p>use <a data-from-md title='file:///C:/MotoGP/WebTools/MotoGPSplineEditor.html' href='file:///C:/MotoGP/WebTools/MotoGPSplineEditor.html'>file:///C:/MotoGP/WebTools/MotoGPSplineEditor.html</a><br>
Selected portugalcirc_pointsreduced.csv<br>
clicked Save for</p>
<ul>
<li>portugalcirc_ai.ini</li>
<li>portugalcirc_friction1.ini<br>
<img src="../../_resources/927ef6b6c87e4f9590a96249bd247720.png" alt="cf86ac29b31543261597f5acfbc908a1.png"></li>
</ul>
<p><a id="6.x" class="jop-noMdConv" href="#"></a><br>
Jump to  <a data-from-md title='#index' href='#index'>this index</a></p>
<h1 id="6-thailand-international-circuit">6. Thailand International Circuit</h1>
<p>This log documents the steps used to produce Thailand.</p>
<h2 id="motogptrace_v3">MotoGPTrace_v3</h2>
<p>I ran <a data-from-md title='file:///C:/MotoGP/WebTools/MotoGPTrace_v3.html,' href='file:///C:/MotoGP/WebTools/MotoGPTrace_v3.html,'>file:///C:/MotoGP/WebTools/MotoGPTrace_v3.html,</a> entered 'Portugal International Circuit' in the search box. It found the circuit.</p>
<p>I had the option set <code class="inline-code">LRLRLRLR</code> (for click points in pairs Left, Right, Left, Right) and <strong>un</strong>checked <code class="inline-code">Output Lambert?</code></p>
<p>After clicking out the track it looks like this:</p>
<p><img src="../../_resources/3032d56a475046f79f036db8393bfc2c.png" alt="2d82e55ef4b825ffeef941d741c1500a.png"><br>
<code class="inline-code">C:\MotoGP\Dorna Assets\Processed Data\Track CSV and INI files\thailand\thailand.csv</code></p>
<h2 id="motogptracemodifier">MotoGPTraceModifier</h2>
<p>load <code class="inline-code">thailand.csv</code></p>
<p>output:</p>
<ul>
<li><code class="inline-code">thailand.kml</code></li>
<li><code class="inline-code">thailand_fromKml.csv</code></li>
<li><code class="inline-code">thailand_fromKml.obj</code></li>
</ul>
<p>I loaded into MotoGPEditHeights but it's very flat so I don't think there is anything to modify.<br>
<img src="../../_resources/6f882659ed854309803bf6e4d06d9f00.png" alt="35fad263b117a0e64f3a862d0a6d58c7.png"></p>
<h2 id="motogpreducepoints">MotoGPReducePoints</h2>
<p>I loaded <code class="inline-code">thailand_fromKml.csv</code> as I hadn't edited any heights and I pressed Reduce<br>
<img src="../../_resources/4b9cd46bb20b40e2aa8f23093047b851.png" alt="63c6b5adfc4a215489c3858a07ceb790.png"></p>
<p>resulting in <code class="inline-code">thailand_pointsreduced.csv</code></p>
<h2 id="motogpinterpolatepath">MotoGPInterpolatePath</h2>
<p>I loaded <code class="inline-code">thailand_pointsreduced.csv</code> resulting in:</p>
<ul>
<li><code class="inline-code">thailand_interpolatedPath.obj</code></li>
<li><code class="inline-code">thailand_exagerated.obj</code></li>
<li><code class="inline-code">thailand_texturedAndCut.obj</code></li>
<li><code class="inline-code">thailand_texturedAndCutLOD.obj</code></li>
</ul>
<p>and sent off to Beep.</p>
<h2 id="motogpsplineeditor">MotoGPSplineEditor</h2>
<p>Again I loaded <code class="inline-code">thailand_pointsreduced.csv</code> resulting in:<br>
<img src="../../_resources/c0bc4ce373a34a80841b2c947cb5bf5a.png" alt="6869a0ab07ea02b5fa82f7f9894008dc.png"></p>
<p>producing</p>
<ul>
<li><code class="inline-code">thailand_ai.ini</code></li>
<li><code class="inline-code">thailand_friction1.ini</code></li>
</ul>
<p>The spline clearly needs editing...</p>
<p>My first pass editing:</p>
<ul>
<li><code class="inline-code">thailand_ai (1).ini</code><br>
<img src="../../_resources/bc1511322f484c828c27d1f8d27ba253.png" alt="6cd000ba69d7139e2801f2a5e8fc085a.png"></li>
</ul>
<h2 id="logging-the-hot-lap-video">Logging the hot lap video</h2>
<p>For a comparison between how our bikes perform and how Marquez performed on a hot lap we get the video logged. Usually I use Emilija Anastasovski <a data-from-md title='mailto:emetogj@gmail.com' href='mailto:emetogj@gmail.com'>emetogj@gmail.com</a> who I originally found on fiverr, she does a good job. With the log I can compare the AI to Marquez and make adjustments.</p>
<h2 id="editing-the-red-transition-points">Editing the red transition points</h2>
<p>Independently of the video log I can generally tune the AI by just scrubbing through the video. The important details are:</p>
<ul>
<li>TransitionSpeed, i.e. the lowest speed reached in the corner</li>
<li>TargetGear, the gear in which the rider should be at the corner</li>
<li>MaxGear, the maximum gear reached before the corner</li>
<li>TurnDirection, 0=none, 1=left, 2=right</li>
</ul>
<p>after editing these points we are then ready to perform the first step of training.</p>
<h2 id="ai-training-step-1">AI Training Step 1</h2>
<p>from MotoGPGamePlugin.cpp</p>
<blockquote>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="py" data-joplin-source-open="```py&#10;" data-joplin-source-close="&#10;```">1) enable:</pre><pre class="hljs"><code><span class="hljs-number">1</span>) enable:</code></pre></div>
</blockquote>
<pre><code>	TRAIN_AI_AUTOMATICALLY (here)
	LOG_AI_AUTOMATICALLY (here)
	ALLOW_LOAD_TRACKS_AS_INI (in XLAiTrack.h)
	ALLOW_LOGGING (in XXLLogFile.h)
	FOLLOW_AI (here)
</code></pre>
<blockquote>
<p>and allow the AI to train, tweak splines, check physics files brief ai log for convergence</p>
</blockquote>
<p>With the &lt;trackName&gt;_ai.ini file and the &lt;trackName&gt;_friction1.ini copied to <code class="inline-code">C:\MotoGP\XXL Racing\motogp_unity_64\Assets\StreamingAssets\conf\env\thailand</code> we can start the first step of training.</p>
<p>For this we need to rebuild motogp_cpp (<code class="inline-code">C:\MotoGP\XXL Racing\MotoGP_cpp\Code\MotoGP_PC.sln</code>) in Visual Studio 2019 and copy the resulting files from:<br>
<code class="inline-code">C:\MotoGP\XXL Racing\MotoGP_cpp\Code\x64\Debug_OGL</code> or <code class="inline-code">C:\MotoGP\XXL Racing\MotoGP_cpp\Code\x64\Release_OGL</code><br>
to:<br>
<code class="inline-code">C:\MotoGP\XXL Racing\motogp_unity_64\Assets\Plugins\x64</code></p>
<p>If the <em>debug</em> version is used then some asserts will show which can be mostly ignored. Other than that the debug version just runs more slowly.</p>
<p>To run this select the scene in unity Scenes\thailand.unity and in Visual Studio 2019 <code class="inline-code">Debug\&gt;Attach to process...</code> selecting the unity process referring to that scene. Starting the game will then start the training.</p>
<p>The training goes through a number of passes restarting the race and therefore reloading the track etc and may therefore pop up asserts which can usually be ignored. I did have one where two spline points were on the same patch so had to be corrected in MotoGPSplineEditor.</p>
<p>After the training passes a number of files can be found in <code class="inline-code">C:\MotoGP\XXL Racing\motogp_unity_64</code>, some logging the physics, which can be compared to Emijila's logs, but the most important are:</p>
<ul>
<li>thailandProcessedAISpline.ini</li>
<li>thailandPathLog1.svg</li>
</ul>
<h2 id="ai-training-step-2">AI Training Step 2</h2>
<blockquote>
<ol start="2">
<li>copy <trackname class="jop-noMdConv">ProcessedAISpline.ini to appropriate folder as trackName.ini</li>
</ol>
</blockquote>
<p>Usually I open <code class="inline-code">C:\MotoGP\XXL Racing\motogp_unity_64\thailandProcessedAISpline.ini</code> and  <code class="inline-code">C:\MotoGP\XXL Racing\motogp_unity_64\Assets\StreamingAssets\conf\env\thailand\thailand_ai.ini</code> in BeyoneCompare and copy the contents over.</p>
<p>By opening the updated ai file and the svg file in MotoGPSplineEditor it is possible to see the paths the AI took and adjust the splines if necessary. In this case the training did a good job and the paths taken appear to be fine, e.g.:<br>
<img src="../../_resources/da0f6b7e945f4905a939a7408dd363a7.png" alt="7f8ca16dd1187859e7811c7f0b87ff51.png"></p>
<h1 id="ai-training-step-3">AI Training Step 3</h1>
<blockquote>
<ol start="3">
<li>enable:<br>
LOG_AI_AUTOMATICALLY<br>
ALLOW_LOAD_TRACKS_AS_INI<br>
ALLOW_LOGGING<br>
FOLLOW_AI</li>
</ol>
</blockquote>
<blockquote>
<pre><code>  to calculate lap times and checkpoints
</code></pre>
</blockquote>
<p>I had to mark the checkpoints in the thailand_ai.ini file by setting</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="py" data-joplin-source-open="```py&#10;" data-joplin-source-close="&#10;```">CheckpointTime = 1000.000
BestCheckpointTime = 1000.000</pre><pre class="hljs"><code>CheckpointTime = <span class="hljs-number">1000.000</span>
BestCheckpointTime = <span class="hljs-number">1000.000</span></code></pre></div>
<p>I should probably have done this first. The start/finish line (black point) is the first checkpoint, then I select a couple of points along the track to split the track into thirds or fourths.</p>
<h1 id="ai-training-step-4">AI Training Step 4</h1>
<blockquote>
<ol start="4">
<li>copy <trackname class="jop-noMdConv">ProcessedAISpline.ini to appropriate folder as trackName.ini</li>
</ol>
</blockquote>
<p>Lap times have been calculated:<br>
<img src="../../_resources/3d840358442644a38f66880d47c259ad.png" alt="3554b7589ccdf4b5e0276de43909b78a.png"></p>
<p>As have checkpoint times:<br>
<img src="../../_resources/97cc6eaf005e423bb006cf7053c57e73.png" alt="4a9aee27b8bfded937c3840894ebf504.png"></p>
<p>I copied the data from right to left.</p>
<h1 id="ai-training-step-5">AI Training Step 5</h1>
<blockquote>
<ol start="5">
<li>enable:<br>
ALLOW_LOAD_TRACKS_AS_INI<br>
ALLOW_LOGGING<br>
FOLLOW_AI</li>
</ol>
</blockquote>
<blockquote>
<pre><code>  measure time needed to first checkpoint, add ~8 insert this value in the spline file
</code></pre>
</blockquote>
<p>I counted 38 and added 8 to get 46 seconds and added this to the file</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">[Track]

NumberOfSegments = 54
StartSegment = 1
EndSegment = 54

GateShape = Radius
GateWidth = 0.200
GateHeight = 1.000
InitialCheckpointTime = 46.000</pre><pre class="hljs"><code><span class="hljs-section">[Track]</span>

<span class="hljs-attr">NumberOfSegments</span> = <span class="hljs-number">54</span>
<span class="hljs-attr">StartSegment</span> = <span class="hljs-number">1</span>
<span class="hljs-attr">EndSegment</span> = <span class="hljs-number">54</span>

<span class="hljs-attr">GateShape</span> = Radius
<span class="hljs-attr">GateWidth</span> = <span class="hljs-number">0.200</span>
<span class="hljs-attr">GateHeight</span> = <span class="hljs-number">1.000</span>
<span class="hljs-attr">InitialCheckpointTime</span> = <span class="hljs-number">46.000</span></code></pre></div>
<h1 id="flags">Flags</h1>
<p>The &lt;trackName&gt;_ai.ini file can contain flags per spline point. These flags are a bitfield so have values 1,2,4,8,16 added together.</p>
<ul>
<li>1</li>
<li>2</li>
<li>4</li>
<li>8</li>
<li>16</li>
</ul>
<p>These drive adjustments in braking logic:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="cpp" data-joplin-source-open="```cpp&#10;" data-joplin-source-close="&#10;```">                if ((mNextTransitionFlags &amp; 0x1) != 0) {
                    /*
                        don't display the track marker, without this check we would display the market for 
                        brake points done automatically by AI for a single frame as mHumanControlTakenAway has not been set yet
                    */
                }
</pre><pre class="hljs"><code>                <span class="hljs-keyword">if</span> ((mNextTransitionFlags &amp; <span class="hljs-number">0x1</span>) != <span class="hljs-number">0</span>) {
                    <span class="hljs-comment">/*
                        don&#x27;t display the track marker, without this check we would display the market for 
                        brake points done automatically by AI for a single frame as mHumanControlTakenAway has not been set yet
                    */</span>
                }
</code></pre></div>
<p>And</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="cpp" data-joplin-source-open="```cpp&#10;" data-joplin-source-close="&#10;```">        /*
            now let the mTrackTurnCosine have some affect on our braking
        */
        float turnRateEffect = LinearlyInterpolate(mLateBrakingPenaltyAmount, 0.0f, 0.8f, sMaxLateAmount, 1.0f);
        mBrake = mBrake * Max(mTrackTurnCosine, turnRateEffect);

        if (mNextTransitionFlags &amp; 0x10) {
            mBrake *= 1.0f; // override increase of braking in these turns
        }
        else if (mMaxGear - mDesiredGear &gt;= 3 || (mNextTransitionFlags &amp; 0x4)) {
            /*
                we are under hard deceleration from high speed, decelerating along a straight
                we can brake harder in a section like this
                was using: if (mSpeedWhenBrakingBegan - mTransitionSpeed &gt; 50) {// m/s
                this would cause a problem where speed reached would affect braking
                the new test is constant as mMaxGear and mDesiredGear are authored
            */
            mBrake *= 1.4f;
        }
        else if (mNextTransitionFlags &amp; 0x8) {
            mBrake = 0.0f; // don't apply brakes just use engine braking in these turns
        }
</pre><pre class="hljs"><code>        <span class="hljs-comment">/*
            now let the mTrackTurnCosine have some affect on our braking
        */</span>
        <span class="hljs-type">float</span> turnRateEffect = <span class="hljs-built_in">LinearlyInterpolate</span>(mLateBrakingPenaltyAmount, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.8f</span>, sMaxLateAmount, <span class="hljs-number">1.0f</span>);
        mBrake = mBrake * <span class="hljs-built_in">Max</span>(mTrackTurnCosine, turnRateEffect);

        <span class="hljs-keyword">if</span> (mNextTransitionFlags &amp; <span class="hljs-number">0x10</span>) {
            mBrake *= <span class="hljs-number">1.0f</span>; <span class="hljs-comment">// override increase of braking in these turns</span>
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mMaxGear - mDesiredGear &gt;= <span class="hljs-number">3</span> || (mNextTransitionFlags &amp; <span class="hljs-number">0x4</span>)) {
            <span class="hljs-comment">/*
                we are under hard deceleration from high speed, decelerating along a straight
                we can brake harder in a section like this
                was using: if (mSpeedWhenBrakingBegan - mTransitionSpeed &gt; 50) {// m/s
                this would cause a problem where speed reached would affect braking
                the new test is constant as mMaxGear and mDesiredGear are authored
            */</span>
            mBrake *= <span class="hljs-number">1.4f</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mNextTransitionFlags &amp; <span class="hljs-number">0x8</span>) {
            mBrake = <span class="hljs-number">0.0f</span>; <span class="hljs-comment">// don&#x27;t apply brakes just use engine braking in these turns</span>
        }
</code></pre></div>
<p>Also this:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="cpp" data-joplin-source-open="```cpp&#10;" data-joplin-source-close="&#10;```">            if (mHumanControlled &amp;&amp; mAccelerateWindowOpen == false &amp;&amp; mAcceleratingFromTransition) {
                /*
                    now we are done with the previous transition check the flags to see if
                    human control is taken away or not for the next transition
                */
                mHumanControlTakenAway = (mNextTransitionFlags &amp; 0x1) ? true : false;
            }</pre><pre class="hljs"><code>            <span class="hljs-keyword">if</span> (mHumanControlled &amp;&amp; mAccelerateWindowOpen == <span class="hljs-literal">false</span> &amp;&amp; mAcceleratingFromTransition) {
                <span class="hljs-comment">/*
                    now we are done with the previous transition check the flags to see if
                    human control is taken away or not for the next transition
                */</span>
                mHumanControlTakenAway = (mNextTransitionFlags &amp; <span class="hljs-number">0x1</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
            }</code></pre></div>
<p>Within all the existing ini files the current values are used, 1, 2, 4, 8, 9, 16</p>
<p>I cannot find any logic using the value 2, there is a single case where this flag is set in the ini for malaysia, it may be an error, it would appear to have no effect.</p>
<p>From the logic above, the value 16 appears to do nothing.</p>
<p>Therefore the meaningful values appear to be:<br>
1, 4, 8 and 9</p>
<p>i.e.:<br>
1 - let the AI handle this transition<br>
4 - Increase deceleration on a hard straight<br>
8 - Don't apply brakes, just use engine braking<br>
9 - Don't apply brakes, just use engine braking, handled by AI</p>
<p>It looks like Thailand needs some of these, but I'll wait till I have a working track from beep and perhaps the video log from Emijila. I will need to retrain the AI using the steps above.</p>
<p>Also I need to change the transition speeds from mph to kph!</p>
<p><code class="inline-code">thailand_ai (7).ini</code> was where I got to. Next I edited this again in MotoGPSplineEditor.</p>
<h1 id="adjusting-the-path">Adjusting the path</h1>
<p>When the AI training runs it generates a number of logging files and also an svg file in the root folder of the unity project. In this case thailandPathLog1.svg.</p>
<p>Loading this into MotoGPSplineEditor along with the friction1 file and the ai file (updated from thailandProcessedAISpline.ini) it is possible to see the paths taken by the AI running perfectly and see if it is cutting corners. Then move the spline points to adjust the path.</p>
<p>Here for example I moved some of the spline points to adjust the path:<br>
<img src="../../_resources/3aca3f7399e64bcc92ce7e8ab9eca79f.png" alt="6c7ec7abf576714f3ed6ddaee17a0b0e.png"></p>
<h1 id="comparing-to-marquez">Comparing to Marquez</h1>
<p>Emijilia's logs are derived from video usually at 25 hz. To compare the bike physics to Emilija's logs we need to scale her data up to 60hz. I do this just using macros in notepad++, first duplicating every line to make it 50hz, the duplicating every 5th line to make it 60 hz. I find where the bike crosses the start line at the beginning and end of the hot lap and trim this data. I end up with a set of data I save as  <code class="inline-code">Thailand Marquez at 60hz.csv</code>. In earlier tracks I had more complex data with lean angle and rpm. For thailand I have limited data, just speed and gear.</p>
<p>Note that speed is speedometer speed. This is different to actual speed, as the bikes are leaned over at such extreme angles the radius of the part of the tire that is touching the ground in the corners reduces the effective radius of the wheel. The speedometer speed implies the bikes are going faster than they actually are. However the game physics is accounting for this change in the effective radius of the wheel targeting and targeting speedometer speed.</p>
<p>I then made a new file <code class="inline-code">Thailand Compare against Marquex.xls</code> in which I copied the columns of <code class="inline-code">Thailand Marquez at 60hz.csv</code> and then pasted in the columns segmentIndex, speed, mGear from thailandPhysicsLog8.csv</p>
<p>I can then graph speed of marquez vs speed of the game and gear used vs gear in the game (red is AI, blue is actual captured data):</p>
<p><img src="../../_resources/699fde9b29794b34a515b44c940da78d.png" alt="044e65f0f3b99a7f5108c15d693154f2.png"><br>
<img src="../../_resources/5d1f9a553dc54dabbe1c3732ade970a5.png" alt="b3f7dfd4d714e87a7345f872762b3b96.png"></p>
<p>The resulting ProcessedAISpline was saved as thailand_ai (14).ini</p>
<p>The game is accelerating out of the corners a little more agressively ending up in this case with a lap time two seconds too fast. When it's this close it is possible to make adjustments using:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="cpp" data-joplin-source-open="```cpp&#10;" data-joplin-source-close="&#10;```">        else if (strcmp(raceName, &quot;thailand&quot;) == 0) {
            pAITrack-&gt;SetTrackControl(0.37f, 0.45f);
        }
</pre><pre class="hljs"><code>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(raceName, <span class="hljs-string">&quot;thailand&quot;</span>) == <span class="hljs-number">0</span>) {
            pAITrack-&gt;<span class="hljs-built_in">SetTrackControl</span>(<span class="hljs-number">0.37f</span>, <span class="hljs-number">0.45f</span>);
        }
</code></pre></div>
<p>The first value is the gTrackSpecificControlMinimum and the second gTrackSpecificControlMultiplier. The two values above were used to create the performance above.</p>
<p>This ends up being used as:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="cpp" data-joplin-source-open="```cpp&#10;" data-joplin-source-close="&#10;```">    /*
        we don't have to brake to an apex so we can accelerate according to the controlAmount
        base the controlAmount on the current turn rate of the track
        this allows the throttle to roll on appropriately according to how much the bike is turning
        current roll and yaw are too unstable to do this
        grab the rollAngle from the mpVehicle
    */
    float rollAngle = *(mpVehicle-&gt;GetRollAnglePointer());
    float trackTurnRate = Max(mTrackTurnCosine, 0.0f);
    /*
        get track specific values for control
    */
    extern float gTrackSpecificControlMinimum;
    extern float gTrackSpecificControlMultiplier;
    float controlAmount = Max(gTrackSpecificControlMinimum, trackTurnRate) * gTrackSpecificControlMultiplier;</pre><pre class="hljs"><code>    <span class="hljs-comment">/*
        we don&#x27;t have to brake to an apex so we can accelerate according to the controlAmount
        base the controlAmount on the current turn rate of the track
        this allows the throttle to roll on appropriately according to how much the bike is turning
        current roll and yaw are too unstable to do this
        grab the rollAngle from the mpVehicle
    */</span>
    <span class="hljs-type">float</span> rollAngle = *(mpVehicle-&gt;<span class="hljs-built_in">GetRollAnglePointer</span>());
    <span class="hljs-type">float</span> trackTurnRate = <span class="hljs-built_in">Max</span>(mTrackTurnCosine, <span class="hljs-number">0.0f</span>);
    <span class="hljs-comment">/*
        get track specific values for control
    */</span>
    <span class="hljs-keyword">extern</span> <span class="hljs-type">float</span> gTrackSpecificControlMinimum;
    <span class="hljs-keyword">extern</span> <span class="hljs-type">float</span> gTrackSpecificControlMultiplier;
    <span class="hljs-type">float</span> controlAmount = <span class="hljs-built_in">Max</span>(gTrackSpecificControlMinimum, trackTurnRate) * gTrackSpecificControlMultiplier;</code></pre></div>
<p>Next I need to experiment with these values.<br>
First I am trying:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="cpp" data-joplin-source-open="```cpp&#10;" data-joplin-source-close="&#10;```">        else if (strcmp(raceName, &quot;thailand&quot;) == 0) {
            pAITrack-&gt;SetTrackControl(0.6f, 0.35f);
        }</pre><pre class="hljs"><code>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(raceName, <span class="hljs-string">&quot;thailand&quot;</span>) == <span class="hljs-number">0</span>) {
            pAITrack-&gt;<span class="hljs-built_in">SetTrackControl</span>(<span class="hljs-number">0.6f</span>, <span class="hljs-number">0.35f</span>);
        }</code></pre></div>
<p><img src="../../_resources/9c50b3985c2349bcb99d21842a4fef48.png" alt="1f69afe00d075180ae34a915c891d40b.png"><br>
<img src="../../_resources/fd9db5957dd04a7ab58b4b46b7f0d1eb.png" alt="42794f3ab616c720fb0ec1df5341b3c8.png"></p>
<p>The resulting ProcessedAISpline was saved as thailand_ai (15).ini</p>
<p>Here we can see our lap times are very close. We are not accelerating as fast but corner better. Our AcheivableDeceleration is generally lower in this second run but better on turns 5 and 9.</p>
<p><img src="../../_resources/9e4e0512d2244b74b98a3b4f68d91936.png" alt="297fef3cb58dbce7af514d61d05f6ccf.png"></p>
<p><img src="../../_resources/7da2d31ec82b40619b69d2db8d13c835.png" alt="dbf0d3b5392a367180e642214b82cf42.png"><br>
Circled in blue are corners 5 and 9.</p>
<p>I tweaked the path a little to avoid track edges as saved as thailand_ai (16).ini.</p>
<h1 id="exploring-settrackcontrol">Exploring SetTrackControl</h1>
<p>I tried various parameters for SetTrackControl. These are kind of hacky but effective. They allow us to tweak track specific cornering behaviour. Here are some runs with different values:<br>
<img src="../../_resources/8e26bc77178a42c280d0c7d585319373.png" alt="8b3ab4f0fb464d84b3aa3f7b923bf42b.png"><br>
<img src="../../_resources/918b7611f9ad4e66873a24ea3c9e5971.png" alt="b5048cb59997e00fd936e304d769d4e8.png"><br>
<img src="../../_resources/27ded0c994224b869d234511fcda0e8a.png" alt="e57b64aacfaa157a1c2b50cca506df50.png"><br>
<img src="../../_resources/cf6fdcefcf0849bfb57bbad50c9e5f36.png" alt="28569bb6a6e964081869ae58f31741c8.png"><br>
<img src="../../_resources/c21147969aa34c4fb658e17a0d5ab75a.png" alt="586713a5f2ca4499124a2e888fbfa711.png"><br>
<img src="../../_resources/1d7181365e5246a7a82f595d9d6577ab.png" alt="f11bb4cbcf8544a64919fb0e35daa05f.png"><br>
<img src="../../_resources/010264c0ec3f49a9b41431204eb79f36.png" alt="42d6d1c39c78a30b6355a5af0c901c48.png"><br>
<img src="../../_resources/04021a8704bd49c6b829d0a25a399978.png" alt="e01631fca10921b9cfb5d74a067f96bd.png"><br>
<img src="../../_resources/9aa7b61ed50447568057e93f6b125a11.png" alt="1b796ddb6899e9140416dc1a26f3b967.png"></p>
<p>Really a combination of things is going on here. The bike physics is tuned in game as fixed, my best estimation of the Honda RC213v from 2017. In the real world, depending on bike, rider and tire grip performance will differ from the blue line so really I'm trying to get a close facsimilie of performance. In this case I wanted to capture the decrease in speed in the short intermediate turns and match the overall lap time. All of this is a compromise and it's really just necessary to play with the values and examine the resulting graph comparisons.<br>
I saved the results in <code class="inline-code">C:\MotoGP\Dorna Assets\Processed Data\Emilija Video Logs\Thailand Compare Against Marquez.xlsx</code></p>
<h2 id="finally">Finally</h2>
<p>I decided to go with 0.6, 0.35. I saved the result as thailand_ai (17).ini. Then I tweaked the path a little as as thailand_ai (18).ini.</p>
<p>I let it train one final time and copied the thailandProcessedAISpline.ini to thailand_ai (19).ini.</p>
<p>I ran stage 3 of AI training producing thailandProcessedAISpline.ini (lap times and checkpoint times) and copied to thailand_ai (20).ini.</p>
<p>I added 8 seconds to initial checkpoint time and made thailand_ai (21).ini.</p>
<p>Finally ran it to make frc and trk files.</p>
<p><a id="7.x" class="jop-noMdConv" href="#"></a><br>
Jump to  <a data-from-md title='#index' href='#index'>this index</a></p>
<h1 id="7-portugal-international-circuit">7. Portugal International Circuit</h1>
<h2 id="motogptrace_v3-2">MotoGPTrace_v3</h2>
<p><img src="../../_resources/bd80100837504e6e8bdfd0867b30e464.png" alt="a480b39a6b2d444d29e6c3275cb35510.png"><br>
<code class="inline-code">C:\MotoGP\Dorna Assets\Processed Data\Track CSV and INI files\portugal\portugal.csv</code></p>
<h2 id="motogptracemodifier-2">MotoGPTraceModifier</h2>
<p>load <code class="inline-code">portugal.csv</code></p>
<p>output:</p>
<ul>
<li><code class="inline-code">portugal.kml</code></li>
<li><code class="inline-code">portugal_fromKml.csv</code></li>
<li><code class="inline-code">portugal_fromKml.obj</code></li>
</ul>
<p>I loaded into MotoGPEditHeights we'll need to see if anything needs modifying.<br>
<img src="../../_resources/e8376d4f9e4b4137ae39da57e8d10c1d.png" alt="4d6f3622dab6f3233d4ca2ba0dfc6bcc.png"></p>
<h2 id="motogpreducepoints-2">MotoGPReducePoints</h2>
<p>I loaded <code class="inline-code">portugal_fromKml.csv</code> as I hadn't edited any heights and I pressed Reduce</p>
<p>resulting in <code class="inline-code">portugal_pointsreduced.csv</code></p>
<h2 id="motogpinterpolatepath-2">MotoGPInterpolatePath</h2>
<p>I loaded <code class="inline-code">portugal_pointsreduced.csv</code> resulting in:</p>
<ul>
<li><code class="inline-code">portugal_interpolatedPath.obj</code></li>
<li><code class="inline-code">portugal_exagerated.obj</code></li>
<li><code class="inline-code">portugal_texturedAndCut.obj</code></li>
<li><code class="inline-code">portugal_texturedAndCutLOD.obj</code><br>
<img src="../../_resources/e7f2fdab9d9d4efc8246d7e062cf617a.png" alt="60be3ea3dc2deb86544d05d6452297bd.png"></li>
</ul>
<p>and sent off to Beep.</p>
<h2 id="motogpsplineeditor-2">MotoGPSplineEditor</h2>
<p>Again I loaded <code class="inline-code">portugal_pointsreduced.csv</code> resulting in:<br>
<img src="../../_resources/33cc81b2f21d4072ae1e317a2c5d4227.png" alt="279e1f6e6bb61651f4b385041f19f53d.png"></p>
<p>producing</p>
<ul>
<li><code class="inline-code">portugal_ai.ini</code></li>
<li><code class="inline-code">portugal_friction1.ini</code></li>
</ul>
<p>The spline clearly needs editing...</p>
<p>Next: My first pass editing saved in:</p>
<ul>
<li><code class="inline-code">portugal_ai (1).ini</code><br>
<img src="../../_resources/79cfd915d0224c6ab591a5b6645905d1.png" alt="a4ad9500cbecd9239a56ed04c83f122f.png"></li>
</ul>
<h2 id="bumps-affecting-the-ai">Bumps affecting the AI</h2>
<h3 id="smoothing-the-bumps">Smoothing the bumps</h3>
<p><img src="../../_resources/cf9e48cad37a49ad853a968199e6c76c.png" alt="37c431123997454ebc7310209d5405d5.png"><br>
<img src="../../_resources/14e460caa7df4657a32cdaac7e449935.png" alt="54951c8f85d10c437fa215442de17802.png"></p>
<table>
<thead>
<tr>
<th>before</th>
<th>after</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="../../_resources/aeccbefa5bb543c38eca8d38ad32c2d4.png" alt="4cc3096b58b8a6dc2a4e44f22c9c23ac.png"></td>
<td><img src="../../_resources/56ad762b40014ad59d0c34cb5d8e1d3c.png" alt="7c76262df53aec437cb3579e40249252.png"></td>
</tr>
<tr>
<td><img src="../../_resources/c1134d379bcb41c8916877596fda9fe1.png" alt="84901bd2821dc2a2434c82fb8a84f303.png"></td>
<td><img src="../../_resources/84bceab2d2e6448b8fabdd141bfe2b27.png" alt="5c3553636feb15f6915b2ec3110d73e2.png"></td>
</tr>
<tr>
<td><img src="../../_resources/6cd476499fda4299910214524dd463be.png" alt="7e532d78261b57866e633f2741fd6c9f.png"></td>
<td><img src="../../_resources/70c7348a28974c48bff492af0ef7487e.png" alt="e33e65f10bb81810513c862f3d7f229c.png"></td>
</tr>
<tr>
<td><img src="../../_resources/7a4bb53a2ee747f2aadf3cc79afec3fd.png" alt="e4c33529a9d7c37d96bcbfe713f11f2f.png"></td>
<td><img src="../../_resources/a2f9bab5d0094859bb79065d49cbddf4.png" alt="dddda7ad1d719ba277e2611d06e3481b.png"></td>
</tr>
<tr>
<td><img src="../../_resources/681114a6560b48ff8bf3ede8dcf4e6c6.png" alt="903f6f4f812b82e9a56dc9623f20d365.png"></td>
<td><img src="../../_resources/c88b8fcfa5674b6bac508ed6bd5f2d7d.png" alt="a278182b9fb0c84ddd92d1fd407816d8.png"></td>
</tr>
</tbody>
</table>
<p>I saved these as <code class="inline-code">portugal_heightsEdited.csv</code> and obj.</p>
<p>I renamed the original <code class="inline-code">portugal_friction1.ini</code> file to <code class="inline-code">portugal_friction1.ini (0)</code> and then used MotoGPSplineEditor with  <code class="inline-code">portugal_heightsEdited.csv</code> to create a <code class="inline-code">new portugal_friction1.ini</code>.</p>
<h3 id="having-the-ai-slow-at-the-crest">Having the AI slow at the crest</h3>
<p>The AI were still tending to leave the ground at the top of the bumps. Essentially they are accelerating across the top and launching. By placing a spline point at the crest I could make this a speed target. I set a transition speed and set the Flags to 9 - Don't apply brakes, just use engine braking, handled by AI.</p>
<p>After training multiple rounds of training with different values for SetTrackControl I settled on (0.35f,0.45f):<br>
<img src="../../_resources/573253a8ca6145efa6b595b16354ce2d.png" alt="a9fac3685c13b573d89c04b67af61189.png"></p>
<p>The lap time is faster than the video but more closely matches the actual track record.</p>
<p>Completing all the final steps for checkpoint times and initial checkpoint time The final spline file was <code class="inline-code">portugal_ai (17).ini</code>. I built the frc and trk files and sent them along with the modified track profile to Beep.</p>
<p><a id="8.x" class="jop-noMdConv" href="#"></a><br>
Jump to  <a data-from-md title='#index' href='#index'>this index</a></p>
<h1 id="8-integrating-new-tracks-into-the-game">8. Integrating new tracks into the game</h1>
<h3 id="the-frc-and-trk-files-and-output-from-motogpinterpolatepath-are-handed-off-to-the-artists">The frc and trk files and output from MotoGPInterpolatePath are handed off to the artists</h3>
<p>They model the track environment buildings etc.</p>
<h3 id="the-game-needs-to-add-the-tracks-unity-side">The game needs to add the tracks unity side</h3>
<p>For code changes see commits 1e8d8bd, 9d9845d and a34ee1c in <a data-from-md title='https://bitbucket.org/MarkDeSimone/motogp_unity_64/commits' href='https://bitbucket.org/MarkDeSimone/motogp_unity_64/commits'>bitbucket.org/MarkDeSimone/motogp_unity_64/commits </a></p>
<h3 id="track-loading-screens-need-to-be-created">Track loading screens need to be created</h3>
<p>Search using other track names for examples.</p>
<h3 id="server-side-needs-to-be-updated">Server side needs to be updated</h3>
<ul>
<li>The New track needs to be added to the database 'circuits' table</li>
<li>The file tools.iced line 12 <code class="inline-code">constNumTracks = </code> needs to be updated</li>
<li><code class="inline-code">iced -c iced_files/tools.iced</code> needs to be run to create the new tools.js</li>
</ul>
</div></div>
					</body>
				</html>
			